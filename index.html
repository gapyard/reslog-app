<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üí™ SitUp Tracker</title>
<style>
  :root{
    --bg:#0f172a; --card:#111827; --line:#1f2937; --text:#e2e8f0; --muted:#94a3b8;
    --primary:#22c55e; --danger:#ef4444; --btn:#1f2937;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",sans-serif}
  .wrap{max-width:900px;margin:0 auto;padding:20px;display:grid;gap:16px}
  h1{margin:0 0 6px;text-align:center}
  .grand{display:flex;justify-content:center}
  .grand-pill{background:#1f2937;color:#e2e8f0;border:1px solid #334155;border-radius:999px;padding:6px 12px;font-weight:700}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .big{font-size:44px;font-weight:800;text-align:center}
  .muted{color:var(--muted);font-size:12px}
  button{border:0;border-radius:12px;padding:12px 14px;background:var(--btn);color:var(--text);cursor:pointer}
  .primary{background:var(--primary);color:#052e16}
  .danger{background:var(--danger)}
  .ghost{background:#1f2937}
  .grid-btn{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  input[type="number"],input[type="date"]{width:100%;padding:10px;border-radius:10px;border:1px solid #374151;background:#0b1220;color:#e2e8f0}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid #1f2937;font-size:14px}
  td.end{white-space:nowrap}
</style>
</head>
<body>
<div class="wrap">
  <h1>üí™ SitUp Tracker</h1>
  <div class="grand"><div id="grandTotal" class="grand-pill">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 0 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div></div>

  <!-- Session panel -->
  <div class="card" id="sessionCard">
    <div class="row">
      <div>
        <div class="muted">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div>
        <input type="date" id="date">
      </div>
      <div>
        <div class="muted">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</div>
        <input type="number" id="goal" min="0" step="1" placeholder="‡πÄ‡∏ä‡πà‡∏ô 100">
      </div>
    </div>

    <div class="big" id="counter">0</div>
    <div style="text-align:center" id="progressText" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°</div>

    <div class="grid-btn" style="margin-top:12px">
      <button onclick="add(1)">+1</button>
      <button onclick="add(5)">+5</button>
      <button onclick="add(10)">+10</button>
      <button class="ghost" onclick="add(-1)">-1</button>
    </div>

    <div class="row" style="margin-top:12px">
      <button class="primary" onclick="startSession()">‡πÄ‡∏£‡∏¥‡πà‡∏°/‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô</button>
      <button class="danger" onclick="resetCount()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ô‡∏±‡∏ö</button>
    </div>
    <div class="row" style="margin-top:8px">
      <button class="primary" onclick="saveToday()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
      <button class="ghost" onclick="undoLast()">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
    </div>
  </div>

  <!-- History -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h3>
      <div>
        <button class="ghost" onclick="exportJSON()">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å JSON</button>
        <button class="ghost" onclick="importJSON()">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ JSON</button>
        <input id="fileImport" type="file" accept="application/json" style="display:none">
      </div>
    </div>
    <div class="muted" id="summaryLine" style="margin:6px 0 10px"></div>
    <div style="overflow:auto">
      <table id="historyTbl">
        <thead>
          <tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏ß‡∏°</th><th>‡πÄ‡∏õ‡πâ‡∏≤</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th class="end">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
        </thead>
        <tbody id="historyBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
/* ===== DB (localStorage) ===== */
const KEY='su_db';
const $=id=>document.getElementById(id);
const todayISO=()=>new Date().toISOString().slice(0,10);
const readDB=()=>{try{return JSON.parse(localStorage.getItem(KEY)||'{}')}catch{return{}}}
const writeDB=db=>localStorage.setItem(KEY,JSON.stringify(db));

/* ===== State ===== */
let count=0, stack=[]; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö undo
let running=false, startTime=0;

/* ===== UI helpers ===== */
function updateUI(){
  $('counter').textContent=count;
  const g = parseInt($('goal').value||0,10);
  const done = g>0 ? Math.min(100, Math.round(count/g*100)) : 0;
  $('progressText').textContent = g>0 ? `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ${count}/${g} (${done}%)` : `‡∏ô‡∏±‡∏ö‡∏™‡∏∞‡∏™‡∏°: ${count}`;
}
function setToday(){
  $('date').value = todayISO();
}
function updateGrandTotal(){
  const db=readDB();
  const sum = Object.values(db).reduce((s,e)=>s+(e?.total||0),0);
  $('grandTotal').textContent = `‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${sum} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
}

/* ===== Actions ===== */
function add(n){
  count = Math.max(0, count + n);
  if(n!==0) stack.push(n);
  updateUI();
}
function resetCount(){
  if(!confirm('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ?')) return;
  count=0; stack=[]; updateUI();
}
function startSession(){
  if(!running){ running=true; startTime=Date.now(); alert('‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚ú®'); }
  else { alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏±‡∏ö‡∏≠‡∏¢‡∏π‡πà‚Ä¶ ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏ö‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô'); }
}
function undoLast(){
  if(!stack.length) return;
  const step=stack.pop();
  count = Math.max(0, count - step);
  updateUI();
}

/* ===== Save/Load ===== */
function saveToday(){
  // Popup ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏Ñ‡∏ß‡∏≠‡∏ó‡∏î‡πâ‡∏ß‡∏¢)
  const ok = confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ?\n\n‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥ "‡∏™‡∏Ñ‡∏ß‡∏≠‡∏ó" ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?\n\n‡∏Å‡∏î "‡∏ï‡∏Å‡∏•‡∏á" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å / "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏ä‡πá‡∏Å‡∏Å‡πà‡∏≠‡∏ô');
  if(!ok) return;

  const db=readDB();
  const d=$('date').value||todayISO();
  const g=parseInt($('goal').value||0,10);
  db[d]={total:count, goal:g, ts:Date.now()};
  writeDB(db);
  running=false; stack=[];
  renderHistory();
  updateGrandTotal(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
  alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úì');
}
function deleteDay(d){
  const db=readDB();
  if(!db[d]) return;
  if(confirm(`‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${d}?`)){
    delete db[d]; writeDB(db); renderHistory(); updateGrandTotal();
  }
}

/* ===== History render ===== */
function renderHistory(){
  const tbody=$('historyBody'); tbody.innerHTML='';
  const db=readDB();
  const arr=Object.entries(db).map(([date,v])=>({date,...v})).sort((a,b)=>b.date.localeCompare(a.date));
  if(!arr.length){ tbody.innerHTML='<tr><td colspan="5" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</td></tr>'; $('summaryLine').textContent=''; return; }

  let sum=0, hit=0, goalSum=0;
  arr.forEach(it=>{
    sum+=it.total||0; goalSum+=it.goal||0; if(it.goal>0 && it.total>=it.goal) hit++;
    const tr=document.createElement('tr');
    const status = it.goal>0 ? (it.total>=it.goal? '‚úÖ ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤' : '‚åõ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á') : '‚Äî';
    tr.innerHTML = `
      <td>${it.date}</td>
      <td>${it.total||0}</td>
      <td>${it.goal||0}</td>
      <td>${status}</td>
      <td class="end">
        <button class="ghost" onclick="loadDay('${it.date}')">‡πÅ‡∏Å‡πâ</button>
        <button class="ghost" onclick="deleteDay('${it.date}')">‡∏•‡∏ö</button>
      </td>`;
    tbody.appendChild(tr);
  });
  $('summaryLine').textContent = `‡∏£‡∏ß‡∏°‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á ${sum} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á | ‡∏ß‡∏±‡∏ô‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤ ${hit}/${arr.length}` + (goalSum? ` | ‡πÄ‡∏õ‡πâ‡∏≤‡∏£‡∏ß‡∏° ${goalSum}` : '');
}

function loadDay(d){
  const db=readDB(); const e=db[d]||{};
  $('date').value=d;
  $('goal').value=e.goal||'';
  count=e.total||0; stack=[]; running=false;
  updateUI();
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ===== Export / Import ===== */
function exportJSON(){
  const payload={version:1, db:readDB()};
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([JSON.stringify(payload,null,2)],{type:'application/json'}));
  a.download='situp-export.json'; a.click(); URL.revokeObjectURL(a.href);
}
function importJSON(){
  $('fileImport').click();
}
$('fileImport').addEventListener('change', async (e)=>{
  const file=e.target.files[0]; if(!file) return;
  try{
    const txt=await file.text(); const obj=JSON.parse(txt);
    const db = obj?.db && typeof obj.db==='object' ? obj.db : obj;
    writeDB(db||{}); renderHistory(); updateGrandTotal(); alert('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úì');
  }catch{ alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); }
});

/* ===== Boot ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  $('date').value = todayISO();
  updateUI();
  renderHistory();
  updateGrandTotal();
});
</script>
</body>
</html>
